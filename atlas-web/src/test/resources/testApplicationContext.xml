<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jee="http://www.springframework.org/schema/jee"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

    <!-- Solr -->
    <bean name="atlasSolrDAO" class="ae3.dao.AtlasSolrDAO">
        <property name="solrServerAtlas" ref="solrServerAtlas"/>
        <property name="solrServerExpt" ref="solrServerExpt"/>
        <property name="dao" ref="atlasDAO"/>
    </bean>

    <bean name="atlasDAO" class="uk.ac.ebi.gxa.dao.AtlasDAO">
        <property name="jdbcTemplate" ref="atlasJdbcTemplate"/>
    </bean>

    <bean name="solrServerAtlas" class="org.apache.solr.client.solrj.embedded.EmbeddedSolrServer">
        <constructor-arg ref="solrContainer"/>
        <constructor-arg value="atlas"/>
    </bean>

    <bean name="solrServerExpt" class="org.apache.solr.client.solrj.embedded.EmbeddedSolrServer">
        <constructor-arg ref="solrContainer"/>
        <constructor-arg value="expt"/>
    </bean>

    <bean name="solrContainer"
          factory-bean="solrContainerFactory"
          factory-method="createContainer"
          destroy-method="shutdown"/>

    <bean id="solrContainerFactory" class="uk.ac.ebi.gxa.index.SolrContainerFactory">
        <property name="atlasIndex" ref="atlasIndex"/>
        <property name="templatePath" value="solr"/>
    </bean>

    <!-- Efo -->
    <bean name="efo" class="uk.ac.ebi.gxa.efo.Efo" destroy-method="close">
        <property name="uri" value="resource:META-INF/efo.owl"/>
        <!-- experimental debugging EFO cache feature -->
        <property name="cache">
            <bean class="java.io.File">
                <constructor-arg value="${atlas.efo.cache}"/>
            </bean>
        </property>
        <!-- can be any external of file url too -->
        <!--<property name="uri" value="http://efo.svn.sourceforge.net/svnroot/efo/trunk/src/efoinowl/InferredEFOOWLview/EFO_inferred.owl"/>-->
    </bean>

    <!-- JDBC -->
    <bean name="atlasJdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
        <!-- datasource bean, from JNDI -->
        <property name="dataSource" ref="atlasDataSource"/>
        <property name="nativeJdbcExtractor" ref="nativeJdbcExtractor"/>
    </bean>

    <bean name="nativeJdbcExtractor"
          class="org.springframework.jdbc.support.nativejdbc.CommonsDbcpNativeJdbcExtractor"/>

    <!-- Resources -->
    <bean id="atlasIndex" class="java.io.File">
        <constructor-arg value="${atlas.index}"/>
    </bean>

    <bean id="atlasDataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close">
        <property name="driverClassName" value="oracle.jdbc.OracleDriver"/>
        <property name="url" value="${atlas-db.jdbc.url}"/>
        <property name="username" value="${atlas-db.jdbc.username}"/>
        <property name="password" value="${atlas-db.jdbc.password}"/>
        <property name="maxActive" value="100"/>
        <property name="maxIdle" value="32"/>
        <property name="initialSize" value="6"/>
        <property name="maxWait" value="-1"/>
    </bean>

    <!-- Other beans -->
    <bean name="annotator" class="ae3.anatomogram.Annotator" init-method="load">
        <property name="efo" ref="efo"/>
    </bean>

</beans>